
  - op: create_thread
    name: t0
  - op: change_property
    type: instance
    module_or_thread: t0
    id: rtos.awsfreertos.thread.name
    value: Sensor Thread
    name: t0_name      
  - op: change_property
    type: instance
    module_or_thread: t0
    id: _symbol
    value: sensor_thread
    name: t0_symbol
  - op: change_property
    type: instance
    module_or_thread: t0
    id: rtos.awsfreertos.thread.priority
    value: 1
    name: t0_priority
  - op: change_property
    type: instance
    module_or_thread: t0
    id: rtos.awsfreertos.thread.stack
    value: 2048
    name: t0_stack_size  
  - op: change_property    
    type: common
    module_or_thread: t0
    id: config.awsfreertos.thread.configuse_recursive_mutexes
    value: config.awsfreertos.thread.configuse_recursive_mutexes.enabled
  # Use Mutexes
  - op: change_property
    type: common
    module_or_thread: t0
    id: config.awsfreertos.thread.configuse_mutexes
    value: config.awsfreertos.thread.configuse_mutexes.enabled 
  {% set sensor_thread = 't0' %}
  
  - op: create_thread
    name: t1
  - op: change_property
    type: instance
    module_or_thread: t1
    id: rtos.awsfreertos.thread.name
    value: BLE Thread
    name: t1_name
  - op: change_property
    type: instance
    module_or_thread: t1
    id: _symbol
    value: ble_thread
    name: t1_symbol
  - op: change_property
    type: instance
    module_or_thread: t1
    id: rtos.awsfreertos.thread.priority
    value: 2
    name: t1_priority  
  - op: change_property
    type: instance
    module_or_thread: t1
    id: rtos.awsfreertos.thread.stack
    value: 2048
    name: t1_stack_size      
  - op: change_property    
    type: common
    module_or_thread: t1
    id: config.awsfreertos.thread.configuse_recursive_mutexes
    value: config.awsfreertos.thread.configuse_recursive_mutexes.enabled
  # Use Mutexes
  - op: change_property
    type: common
    module_or_thread: t1
    id: config.awsfreertos.thread.configuse_mutexes
    value: config.awsfreertos.thread.configuse_mutexes.enabled      

  # Add Heap.
  - op: add
    name: heap_4
    id: module.freertos.heap.4
    thread: t1

  # Enable timerpendfunctioncall.
  - op: change_property
    type: common
    module_or_thread: t1
    id: config.awsfreertos.thread.include_xtimerpendfunctioncall
    value: config.awsfreertos.thread.include_xtimerpendfunctioncall.enabled
    name: timerpendfunctioncall

  # Enable dynamic allocation.
  - op: change_property
    type: common
    module_or_thread: t1
    id: config.awsfreertos.thread.configsupport_dynamic_allocation
    value: config.awsfreertos.thread.configsupport_dynamic_allocation.enabled
    name: dynamic_allocation

  # Set Heap Size.
  - op: change_property
    type: common
    module_or_thread: t1
    id: config.awsfreertos.thread.configtotal_heap_size
    value: 0x800
  {% set conn_thread = 't1' %}

# Jump to the module template   
{% include module_path + '/' + 'pmod' + '/' + conn_module.name + '/' + conn_module.name + '.yml.j2' %}

{% include module_path + '/' + 'pmod' + '/' + sensor_module.name + '/' + sensor_module.name + '.yml.j2' +%}

  - op: change_property
    module_or_thread: bsp
    type: common
    id: config.bsp.common.heap
    value: 0x800
    name: bsp_heap_alloc

  - op: change_property
    module_or_thread: bsp
    type: common
    id: config.bsp.common.main
    value: 0x800
    name: bsp_stack_alloc

  - op: add_file
    src: applications/custom_profile/{{rtos_name}}/src/gui_cfg.h  
    dst: src/gui_cfg.h
  - op: add_file
    src: applications/custom_profile/{{rtos_name}}/src/qc_svc.c
    dst: src/qc_svc.c
  - op: add_file
    src: applications/custom_profile/{{rtos_name}}/src/qc_svc.h
    dst: src/qc_svc.h
  - op: add_file
    src: applications/custom_profile/{{rtos_name}}/src/ble_thread_entry.c
    dst: src/ble_thread_entry.c
  - op: add_file
    src: applications/custom_profile/{{rtos_name}}/src/sensor_thread_entry.c
    dst: src/sensor_thread_entry.c
  - op: add_folder
    src: applications/custom_profile/{{rtos_name}}/src/qe_gen
    dst: src/qe_gen

  # Add Files for Segger RTT
  - op: add_file
    src: applications/common_files/console/RTT/rtt_stout.c
    dst: src/rtt_stout.c
  - op: add_folder
    src: applications/common_files/console/RTT/SEGGER_RTT
    dst: src/SEGGER_RTT

  # Add Files for common files   
  - op: add_file
    src: applications/common_files/misc/user.h
    dst: src/user.h    
  - op: add_file
    src: applications/common_files/misc/{{rtos_name}}/common_utils.h      
    dst: src/common_utils.h    
  - op: add_file
    src: applications/common_files/misc/{{rtos_name}}/common_utils.c      
    dst: src/common_utils.c  

  # Documentation
  - op: add_file
    src: applications/{{app_name}}/Documentation/README.md
    dst: README.md

  - op: generate      

  - op: replace_in_file
    src: ra/fsp/src/rm_ble_abs_gtl/r_ble_gtl_api.c
    match: |
        #include "qe_ble_profile.h"
    replace: |        
        #include "qe_gen/ble/qe_ble_profile.h"
  - op: replace_in_file
    src: ra/renesas/wireless/da14xxx/r_ble_gtl/r_ble_gtl.c
    match: |
        #include "qe_ble_profile.h"
    replace: |        
        #include "qe_gen/ble/qe_ble_profile.h"

  - op: replace_in_file
    src: src/qe_gen/ble/profile_cmn/r_ble_servc_if.c
    match: |
        #include "discovery/r_ble_disc.h"
    replace: |        
        #include "qe_gen/ble/discovery/r_ble_disc.h"

#Add module replacements

{% include module_path + '/' + 'pmod' + '/' + sensor_module.name  + '/' + 'applications_src_replacements/' + app_name + '/' + rtos_name + '/' + 'user.h.yml' %}

{% include module_path + '/' + 'pmod' + '/' + sensor_module.name  + '/' + 'applications_src_replacements/' + app_name + '/' + rtos_name + '/' + 'app_main.c.yml' %}

{% include module_path + '/' + 'pmod' + '/' + sensor_module.name  + '/' + 'applications_src_replacements/' + app_name + '/' + rtos_name + '/' + 'gui_cfg.h.yml' %}

{% include module_path + '/' + 'pmod' + '/' + sensor_module.name  + '/' + 'applications_src_replacements/' + app_name + '/' + rtos_name + '/' + 'sensor_thread_entry.c.yml' %}

  - op: build
    completed: 1  
    
